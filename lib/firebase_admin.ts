import admin from 'firebase-admin';
import crypto from 'crypto-js';

const encryptedJsonText =
  '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';

if (admin.apps.length == 0 && process.env.CREDENTIAL_CRYPT_KEY) {
  const bytes = crypto.AES.decrypt(
    encryptedJsonText,
    process.env.CREDENTIAL_CRYPT_KEY
  );
  const originalText = bytes.toString(crypto.enc.Utf8);
  const credentialJson = JSON.parse(originalText);

  admin.initializeApp({
    databaseURL: process.env.NEXT_PUBLIC_FIREBASE_DATABASE_URL,
    credential: admin.credential.cert(credentialJson),
    storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,
  });
}
